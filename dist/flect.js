!function(){"use strict";let t,s=0;class i extends HTMLElement{static t=new DOMParser;constructor(){super(),this.i=!0,this.h={},this.l=this.l||{},this.o=this.o||!1,this.u={},this.hasAttribute("noinit")||this.init()}init(){this.m(),this.p(),this.D()}ref(t){return this.h[t]?this.h[t][0]:void 0}refs(t){return this.h[t]}v(t,s,i){if(i(t,s),"string"==typeof s)return!1;for(let e in s){let h=t+"."+e;this.v(h,s[e],i)}}p(){this.l.body=[].slice.call(this.childNodes),this.l.M=this.innerHTML,this.l.text=this.textContent;for(let t of this.attributes)if("x"!==t.name[0]||"-"!==t.name[1])if("datas-"===t.name.substring(0,6)){let s=t.name.substring(6),i=JSON.parse(t.value);this.flat(s,i)}else this.l[t.name]=t.value}m(){this.O={$:{},effect(t,s,i,e){this.$[t]||(this.$[t]=new Map),this.$[t].get(s)||this.$[t].set(s,[]),this.$[t].get(s).push(i),void 0!==e&&i(e,s)},clear(t,s){s?this.$[t].delete(s):delete this.$[t]},set(t,s,i){if(t[s]=i,this.$[s])for(let[t,e]of this.$[s])for(let s of e)s(i,t);return!0}},this.datas=new Proxy(this.l,this.O)}g(t,s){this.h[t]||(this.h[t]=[]),this.h[t].push(s)}flat(t,s=!1){s||(s=this.l[t]),this.v(t,s,((t,s)=>{this.datas[t]=s}))}D(){this.S.P.call(this,this.datas,this.A.bind(this),this.j.bind(this))}A(e){if(!e)return;if(!this.S.k&&(this.S.k=i.t.parseFromString(e,"text/html"),this.S.style)){let i=function(i){t||(t=document.createElement("style"),t.id="x-scoped-stylesheet",document.head.appendChild(t));let e="x"+s++,h=`[style-ref="${e}"]`;return t.textContent+=i(h),e}(this.S.style),e=this.S.k.body.querySelectorAll(":scope > *");for(let t of e)t.setAttribute("style-ref",i)}this.C=this.S.k.cloneNode(!0).body,this.F(this.C);const h=this.C.childNodes;for(let t of h)t.o=this.o;this.replaceWith(...h)}j(t){if(!this.S.style&&this.S.k)throw"You should render style before DOM !";this.S.style||(this.S.style=t)}effect(t,s){this.O.effect(t,this,s,this.l[t])}H(t,s,i){let e=t.querySelectorAll("*");for(let t of e)for(let e of t.attributes)"x"===e.name[0]&&"-"===e.name[1]&&(e.value.startsWith(s+".")?t.setAttribute(e.name,i+e.value.substring(s.length)):t.setAttribute(e.name,i))}J(t){t.x=this,"X"===t.tagName[0]&&"-"===t.tagName[1]?this.L(t):this.N(t)}R(t){this.J(t);let s=t.querySelectorAll(":scope > *");for(let t of s)this.R(t)}F(t){let s=t.querySelectorAll(":scope > *");for(let t of s)this.R(t)}T(t,s,i){t.l[i]=this.l[s];this.O.effect(s,t,((t,s)=>{s.datas[i]=t}))}L(t){for(let s of t.attributes)if("x"===s.name[0]&&"-"===s.name[1]){let i=s.name.substring(2);t.l||(t.l={}),"datas-"===i.substring(0,6)&&(i=i.substring(6),this.v("",this.l[s.value],((e,h)=>{this.datas[s.value+e]=h,this.T(t,s.value+e,i+e)}))),this.T(t,s.value,i)}else"ref"===s.name&&this.g(s.value,t)}N(t){for(let s=0,i=0;s<t.attributes.length;s++,i++){let i=t.attributes[s],e=!0;if("x"===i.name[0]&&"-"===i.name[1]){let s=i.name.substring(2),e=(t,i)=>{i.setAttribute(s,t)};if("text"===s)e=(t,s)=>{s.textContent=t};else if("html"===s)e=(t,s)=>{s.innerHTML=t};else if("append"===s)e=(t,s)=>{t.length?s.append(...t):s.append(t)};else if("prepend"===s)e=(t,s)=>{t.length?s.prepend(...t):s.prepend(t)};else if("toggle"===s)e=(t,s)=>{s.classList.toggle(t,t)};else if("show"===s)e=(t,s)=>{t?s.style.removeProperty("display"):s.style.display="none"};else if("if"===s||"unless"===s)e=(t,i)=>{i.X||(i.X=document.createElement("div"));let e=i.childNodes.length;"if"===s?t&&!e?this.Y(i.X,i):!t&&e&&this.Y(i,i.X):"unless"===s&&(t&&e?this.Y(i,i.X):t||e||this.Y(i.X,i))};else if("for"===s){const t=i.value;e=(s,i)=>{i.q||(i.q=[],i.B=0,i.G=document.createElement("div"),this.Y(i,i.G));let e="number"==typeof s,h=!e&&i.getAttribute("var"),l=e?s:s.length,f=l-i.B;if(f>0){for(let e=0;e<i.B+f&&e<l;e++)if(h&&(this.datas[t+"."+e]=s[e]),e>=i.B){if(!i.q[e]){let s=i.G.cloneNode(!0);h&&this.H(s,h,t+"."+e),s.childNodes.forEach((t=>{t.o=e})),this.F(s),i.q.push(s)}this.Y(i.q[e],i)}}else if(f<0)for(let t=i.B-1;t>i.B-1+f&&t>=0;t--)for(;i.childNodes.length;){let s=i.childNodes[i.childNodes.length-1];if(s.o!==t)break;i.q[t].prepend(s)}i.B+=f}}this.O.effect(i.value,t,e,this.l[i.value])}else"ref"===i.name?this.g(i.value,t):e=!1;e&&(t.removeAttribute(i.name),s--)}}Y(t,s){for(;t.childNodes.length;){let i=t.childNodes[0];s.appendChild(i)}}}customElements.define("x-element-prototype-factory",i),window.define=function(t,s){let e=`x${t}Element`;if(window[e])throw`Element x-${t} is already defined !`;if(!s)throw`Element x-${t} need a render function !`;window[e]=class extends i{constructor(){super()}static name=t;static P=s;static k=!1;static style=!1},window[e].prototype.S=window[e],customElements.define(`x-${t}`,window[e])}}();
