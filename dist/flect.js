!function(){"use strict";let t,e=0;class i extends HTMLElement{static t=new DOMParser;static parse(t){return i.t.parseFromString(t,"text/html").body}constructor(){super(),this.i=!0,this.h={},this.l=this.l||{},this.o=this.o||!1,this.custom={},this.hasAttribute("noinit")||this.init()}init(){this.u(),this.m(),this.p()}ref(t){return this.h[t]?this.h[t][0]:void 0}refs(t){return this.h[t]}g(t){return t.split(".")}v(t){let e=this.l;for(let i of t)if(e=e[i],void 0===e)break;return e}m(){this.l.body=[].slice.call(this.childNodes),this.l.html=this.innerHTML,this.l.text=this.textContent;for(let t of this.attributes)if("x"!==t.name[0]||"-"!==t.name[1])if("datas-"===t.name.substring(0,6)){let e=t.name.substring(6),i=JSON.parse(t.value);this.l[e]=i}else this.l[t.name]=t.value}u(){this.P={D:{},effect(t,e,i,s){this.D[t]||(this.D[t]=new Map),this.D[t].get(e)||this.D[t].set(e,[]),this.D[t].get(e).push(i),void 0!==s&&i(s,e)},clear(t,e){e?this.D[t].delete(e):delete this.D[t]},set(t,e,i){if(t[e]=i,this.D[e])for(let[t,s]of this.D[e])for(let e of s)e(i,t);return!0}},this.datas=new Proxy(this.l,this.P)}M(t){return(t.$?"!":"")+t.join(".")}O(t,e){this.h[t]||(this.h[t]=[]),this.h[t].push(e)}iterable(t,e){this.effect(t,(()=>{this.datas[e]=new Proxy(this.datas,function(t){return{get:(e,i)=>"_xiterable"===i||("get"===i?e[t]:{get key(){return i},get value(){return e[t][i]},get parent(){return e[t]}})}}(t))}))}p(){this.S.k.call(this,this.datas,this.A.bind(this),this.j.bind(this))}A(s){if(!s)return;if(!this.S.C&&(this.S.C=i.parse(s),this.S.style)){let i=function(i){t||(t=document.createElement("style"),t.id="x-scoped-stylesheet",document.head.appendChild(t));let s="x"+e++,h=`[style-ref="${s}"]`;return t.textContent+=i(h),s}(this.S.style),s=this.S.C.querySelectorAll(":scope > *");for(let t of s)t.setAttribute("style-ref",i)}this.H=this.S.C.cloneNode(!0),this.J(this.H);const h=this.H.childNodes;for(let t of h)t.o=this.o;this.replaceWith(...h)}j(t){if(!this.S.style&&this.S.C)throw"You should render style before DOM !";this.S.style||(this.S.style=t)}effect(t,e){this.P.effect(t,this,e,this.l[t])}L(t,e,i){let s=t.querySelectorAll("*");for(let t of s)for(let s of t.attributes)if("x"===s.name[0]&&"-"===s.name[1]){let h=this.g(s.value);h[0]===e&&(h[0]=i,t.setAttribute(s.name,this.M(h)))}}N(t){t.R||(t.component=this,t.R=!0,"X"===t.tagName[0]&&"-"===t.tagName[1]?this.T(t):this.X(t))}Y(t){this.N(t),this.J(t)}J(t){let e=t.querySelectorAll(":scope > *");for(let t of e)this.Y(t)}T(t){for(let e of t.attributes)if("x"===e.name[0]&&"-"===e.name[1]){let i=e.name.substring(2),s=this.g(e.value),h=()=>{t.datas[i]=this.v(s)};t.l||(t.l={}),this.P.effect(s[0],t,h),t.l[i]=this.v(s)}else"ref"===e.name&&this.O(e.value,t)}X(t){for(let e=0,s=0;e<t.attributes.length;e++,s++){let s=t.attributes[e],h=!0;if("x"===s.name[0]&&"-"===s.name[1]){let e=s.name.substring(2),h=this.g(s.value),r=()=>{t.setAttribute(e,this.v(h))};if("text"===e)r=()=>{t.textContent=this.v(h)};else if("html"===e)r=()=>{t.innerHTML=this.v(h)};else if("append"===e)r=()=>{let e=this.v(h);e&&(e.length?t.append(...e):t.append(e))};else if("prepend"===e)r=()=>{let e=this.v(h);e&&(e.length?t.prepend(...e):t.prepend(e))};else if("toggle"===e)r=()=>{let e=this.v(h);t.classList.toggle(e,e)};else if("show"===e)r=()=>{this.v(h)?t.style.removeProperty("display"):t.style.display="none"};else if("if"===e||"unless"===e)t._||(t._=document.createElement("div"),this.J(t)),r=()=>{let i=this.v(h),s=t.childNodes.length;"if"===e?i&&!s?this.q(t._,t):!i&&s&&this.q(t,t._):"unless"===e&&(i&&s?this.q(t,t._):i||s||this.q(t._,t))};else if("for"===e){const e=s.value,l=t.getAttribute("var");t.B||(t.B=[],t.F=0,t.G=i.parse(t.innerHTML),t.innerHTML=""),r=()=>{let i=this.v(h);if(void 0===i)return;i.I&&(i=i.get);let s="number"==typeof i?i:i.length,r=s-t.F;if(r>0)for(let i=t.F;i<t.F+r&&i<s;i++){if(!t.B[i]){let s=t.G.cloneNode(!0);l&&this.L(s,l,e+"."+i),s.childNodes.forEach((t=>{t.o=i})),this.J(s),t.B.push(s)}this.q(t.B[i],t)}else if(r<0)for(let e=t.F-1;e>t.F-1+r&&e>=0;e--)for(;t.childNodes.length;){let i=t.childNodes[t.childNodes.length-1];if(i.o!==e)break;t.B[e].prepend(i)}t.F+=r}}this.P.effect(h[0],t,r,this.l[h[0]])}else"ref"===s.name?this.O(s.value,t):h=!1;h&&(t.removeAttribute(s.name),e--)}}q(t,e){for(;t.childNodes.length;){let i=t.childNodes[0];e.appendChild(i)}}}customElements.define("x-element-prototype-factory",i),window.define=function(t,e){let s=`x${t}Element`;if(window[s])throw`Element x-${t} is already defined !`;if(!e)throw`Element x-${t} need a render function !`;return window[s]=class extends i{constructor(){super()}static name=t;static k=e;static C=!1;static style=!1},window[s].prototype.S=window[s],customElements.define(`x-${t}`,window[s]),window[s]}}();
