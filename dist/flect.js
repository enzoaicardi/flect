var Flect=function(t){"use strict";let e=new DOMParser;function i(t,e){let i=e.children,s=[];for(let e in i){let n=i[e],h=n.t,l=t.childNodes[e];l.component=this,n.i||s.push(l),!t.h||(l.h=t.h);for(let t in h){this.l.effect(t,l,h[t]);for(let[e,i]of h[t])e.call(this,null,l,i)}for(let t of n.o)t.call(this,l,n);n.u||s.push(...this.p(l,n))}return s}function s(t){return"X-FOR"===t.tagName||"X-IF"===t.tagName}function n(t){return 0===t.tagName.indexOf("X-")&&!s(t)}function h(t){return 0===t.indexOf("x-")}function l(t){return 0===t.indexOf("x-on:")}function f(t){return"x-scoped"===t}let r="style-ref",o="xEventHandler_";function u(t){switch(t){case"x-text":return d;case"x-html":return p;case"x-show":return x;case"x-ref":return m;default:return w}}function c(t){t.setAttribute(r,this.m.selector)}function a(t,e){for(let i of e.X.v)t.addEventListener(i,e.X)}function d(t,e,i){e.textContent=this.F(i,e)}function p(t,e,i){e.innerHTML=this.F(i,e)}function x(t,e,i){let s=e.style.display;this.F(i,e)?e.style.display="none":s?e.style.display=s:e.style.removeProperty("display")}function m(t,e,i){if(t){let t=this.M[i.O];!t||t(e)}else for(let t of this.$[i.O])t(e)}function w(t,e,i){e.setAttribute(i.g,this.F(i,e))}function y(t,e,i){e.datas||(e.datas={}),e.datas[i.g]=this.F(i,e)}let v=document.createComment("");function X(t,e,i){}function E(t,e,i){e.h||(e.h=[]),e.P||(e.P={}),e.R||(e.R=0);let s=i.k,n=e.R,h=this.getData(i,e),l="number"==typeof h?h:h.length,f=l-n;if(f>0)for(let t=n;t<n+f&&t<l;t++){let n=s.rootElement.cloneNode(!0),h=v.cloneNode();h.rootElement=s.rootElement,n.h=new Map(e.h),n.h.set(i,t),e.P[t]=this.p(n,s);do{e.parentNode.insertBefore(h,e)}while(h=n.firstChild)}else if(f<0){for(let t=n-1;t>n-1+f&&t>=0;t--){let i={};for(;(!i.rootElement||i.rootElement!==s.rootElement)&&(i=e.previousSibling);)i.remove();this.C(e.P[t])}console.log("- remove element",this.l.t,this.l.mapping)}e.R+=f}let F=/\{[a-zA-Z0-9_.$!?|-]+\}/g;function M(t,e={}){let i={D:"!"===t[0],H:("!"===t[0]?t.substring(1):t).split(".").map((t=>t.split("|")))},s=e[O(i)];return i.I=O(s||i),i.H[0].S=s,i}function O(t){return t.I||t.H[0][0]}function b(t,e){let i={datas:{},O:t},s=t.match(F);if(s)for(let t of s)i.datas[t]=M(t.substring(1,t.length-1),e);else i.datas[t]=M(t,e);return i}function $(t,e={}){let i,r={type:t.tagName,t:{},o:[],children:{}};if(s(t)){let s=t.getAttribute("key"),n=t.getAttribute("var");if(n){let h=M(n,e),l=function(t){switch(t){case"X-IF":return X;case"X-FOR":return E;default:throw"Undefined"}}(t.tagName);!s||(e[s]=h),i||(i=r),i.u=!0,i.rootElement=t,i.t[h.I]=[[l,h]],h.k=i}t.replaceWith(v.cloneNode())}else for(let s=0;s<t.attributes.length;s++){let d=t.attributes[s],p=d.name,x=d.value;if(h(p)){if(i||(i=r),l(p)){let t=p.substring(5);i.X||(i.X={v:[],_:t=>{i.X[o+t.type].call(this,t)}}),i.X.v.push(t),i.X[o+t]=this[x],i.o.push(a)}else if(f(p))!this.m.selector||i.o.push(c);else{let s=n(t)&&t!==this?y:u(p),h=b(x,e);h.g=p.substring(2);for(let t in h.datas){let e=h.datas[t].I;i.t[e]||(i.t[e]=[]),i.t[e].push([s,h])}}t.removeAttribute(p),s--}}if(!n(t)||t===this){let s=t.firstChild,n=0;if(s)do{if(1===s.nodeType||8===s.nodeType){let t=this.j(s,e);t&&(i||(i=r)&&(i.i=!0),i.children[n]=t)}n++}while(s=s.nextSibling)}return i}function g(t){for(let e of t){if(!e.tagName||!n(e)||e.A(),e.P)for(let t in e.P)this.C(e.P[t]);this.l.remove(e)}}let P=0,R=!1;function k(t,e){return t.datas[t.O]?this.getData(t.datas[t.O],e):t.O.replace(F,(i=>this.getData(t.datas[i],e)))}function C(t,e){let i=this.M;for(let s=0;s<t.H.length&&i;s++){let n=t.H[s];i=n.S?this.getData(n.S,e)[e.h.get(n.S)]:i[n[0]];for(let t=1;t<n.length;t++)i=this.filters[n[t]](i)}return t.D?!i:i}class D extends HTMLElement{constructor(){super(),this.M=this.datas,this.datas={},this.filters={},this.t={},this.$={},this.j=$,this.C=g,this.p=i,this.F=k,this.getData=C}J(){this.init(),this.L(),this.M=this.M?Object.assign(this.datas,this.M):this.datas,this.N(),this.T&&(this.m.selector||this.U()),this.Z()}A(){this.disconnect(),delete this.datas,delete this.l,delete this.M,delete this.$,delete this.filters,delete this.t}init(){}disconnect(){}refs(t,e){let i=this.$;i[t]||(i[t]=[]),i[t].push(e),this.datas[t]=e}L(){let t=this.datas;t.body=this.childNodes;for(let e of this.attributes){let i=e.name;if("datas-"===i.substring(0,6)){let s=JSON.parse(e.value);t[i.substring(6)]=s}else t[i]=e.value}}N(){var t;this.l={q:t=this,t:{},mapping:new Map,effect(t,e,i){let s=this.t,n=this.mapping;s[t]||(s[t]=new Map),s[t].get(e)||(s[t].set(e,[]),n.get(e)||n.set(e,[])),s[t].get(e).push(...i),n.get(e).push(t)},remove(t){for(let e of this.mapping.get(t))this.t[e].delete(t),this.mapping.delete(t)},B(e,i){let s=this.t;if(s[e])for(let[n,h]of s[e])for(let[e,s]of h)e.call(t,i,n,s)},set(t,e,i){return t[e]=i,this.B(e,i),!0}},this.datas=new Proxy(this.M,this.l);for(let t in this.t)this.l.effect(t,this,[[this.t[t]]]),this.t[t](this.M[t])}U(){this.m.selector=function(t){let e="x"+P++;return R||(R=document.createElement("style"),document.head.appendChild(R)),R.textContent+=t(`[${r}="${e}"]`),e}(this.T)}Z(){let t,i=this.m;if(!i.G){let n=this.K();"string"!=typeof n?t=n:i.G=(s=n,e.parseFromString(s,"text/html").body),i.k=this.j(i.G||n)}var s;t||(t=i.G.cloneNode(!0)),!i.k||this.p(t,i.k),this.replaceWith(...t.childNodes)}}let H={},I=D;return t.define=function(t,e){if(H[t])throw`Component x-${t} is already defined !`;e.prototype.m=e,customElements.define("x-"+t,e)},t.x=I,t}({});
