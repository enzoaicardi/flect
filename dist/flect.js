!function(){"use strict";let t,i=0;class s extends HTMLElement{static t=new DOMParser;static clone=function(t){return s.t.parseFromString(t,"text/html").body};constructor(){super(),this.i=!0,this.h={},this.l=this.l||{},this.o=this.o||!1,this.custom={},this.hasAttribute("noinit")||this.init()}init(){this.u(),this.m(),this.p()}ref(t){return this.h[t]?this.h[t][0]:void 0}refs(t){return this.h[t]}D(t,i,s){if(s(t,i),"string"==typeof i)return!1;for(let e in i){let h=t+"."+e;this.D(h,i[e],s)}}m(){this.l.body=[].slice.call(this.childNodes),this.l.html=this.innerHTML,this.l.text=this.textContent;for(let t of this.attributes)if("x"!==t.name[0]||"-"!==t.name[1])if("datas-"===t.name.substring(0,6)){let i=t.name.substring(6),s=JSON.parse(t.value);this.flat(i,s)}else this.l[t.name]=t.value}u(){this.g={M:{},effect(t,i,s,e){this.M[t]||(this.M[t]=new Map),this.M[t].get(i)||this.M[t].set(i,[]),this.M[t].get(i).push(s),void 0!==e&&s(e,i)},clear(t,i){i?this.M[t].delete(i):delete this.M[t]},set(t,i,s){if(t[i]=s,this.M[i])for(let[t,e]of this.M[i])for(let i of e)i(s,t);return!0}},this.datas=new Proxy(this.l,this.g)}O(t,i){this.h[t]||(this.h[t]=[]),this.h[t].push(i)}flat(t,i=!1){i||(i=this.l[t]),this.D(t,i,((t,i)=>{this.datas[t]=i}))}p(){this.v.$.call(this,this.datas,this.P.bind(this),this.S.bind(this))}P(e){if(!e)return;if(!this.v.A&&(this.v.A=s.clone(e),this.v.style)){let s=function(s){t||(t=document.createElement("style"),t.id="x-scoped-stylesheet",document.head.appendChild(t));let e="x"+i++,h=`[style-ref="${e}"]`;return t.textContent+=s(h),e}(this.v.style),e=this.v.A.querySelectorAll(":scope > *");for(let t of e)t.setAttribute("style-ref",s)}this.j=this.v.A.cloneNode(!0),this.k(this.j);const h=this.j.childNodes;for(let t of h)t.o=this.o;this.replaceWith(...h)}S(t){if(!this.v.style&&this.v.A)throw"You should render style before DOM !";this.v.style||(this.v.style=t)}effect(t,i){this.g.effect(t,this,i,this.l[t])}C(t,i,s){let e=t.querySelectorAll("*");for(let t of e)for(let e of t.attributes)"x"===e.name[0]&&"-"===e.name[1]&&(e.value.startsWith(i+".")?t.setAttribute(e.name,s+e.value.substring(i.length)):e.value===i&&t.setAttribute(e.name,s))}F(t){t.H||(t.component=this,t.H=!0,"X"===t.tagName[0]&&"-"===t.tagName[1]?this.J(t):this.L(t))}N(t){this.F(t);let i=t.querySelectorAll(":scope > *");for(let t of i)this.N(t)}k(t){let i=t.querySelectorAll(":scope > *");for(let t of i)this.N(t)}R(t,i,s){t.l[s]=this.l[i];this.g.effect(i,t,((t,i)=>{i.datas[s]=t}))}J(t){for(let i of t.attributes)if("x"===i.name[0]&&"-"===i.name[1]){let s=i.name.substring(2);t.l||(t.l={}),"datas-"===s.substring(0,6)&&(s=s.substring(6),this.D("",this.l[i.value],((e,h)=>{this.datas[i.value+e]=h,this.R(t,i.value+e,s+e)}))),this.R(t,i.value,s)}else"ref"===i.name&&this.O(i.value,t)}L(t){for(let i=0,e=0;i<t.attributes.length;i++,e++){let e=t.attributes[i],h=!0;if("x"===e.name[0]&&"-"===e.name[1]){let i=e.name.substring(2),h=(t,s)=>{s.setAttribute(i,t)};if("text"===i)h=(t,i)=>{i.textContent=t};else if("html"===i)h=(t,i)=>{i.innerHTML=t};else if("append"===i)h=(t,i)=>{t.length?i.append(...t):i.append(t)};else if("prepend"===i)h=(t,i)=>{t.length?i.prepend(...t):i.prepend(t)};else if("toggle"===i)h=(t,i)=>{i.classList.toggle(t,t)};else if("show"===i)h=(t,i)=>{t?i.style.removeProperty("display"):i.style.display="none"};else if("if"===i||"unless"===i)h=(t,s)=>{s.T||(s.T=document.createElement("div"),this.k(s));let e=s.childNodes.length;"if"===i?t&&!e?this.X(s.T,s):!t&&e&&this.X(s,s.T):"unless"===i&&(t&&e?this.X(s,s.T):t||e||this.X(s.T,s))};else if("for"===i){const t=e.value;h=(i,e)=>{e.Y||(e.Y=[],e.q=0,e.B=e.innerHTML,e.innerHTML="");let h="number"==typeof i,l=e.getAttribute("var"),f=h?i:i.length,o=f-e.q;if(this.datas[t+".length"]=f,o>0){for(let n=0;n<e.q+o&&n<f;n++)if(this.datas[t+"."+n]=h?n:i[n],this.datas[t+"."+n+".index"]=n,n>=e.q){if(!e.Y[n]){let i=s.clone(e.B);this.C(i,l,t+"."+n),i.childNodes.forEach((t=>{t.o=n})),this.k(i),e.Y.push(i)}this.X(e.Y[n],e)}}else if(o<0)for(let s=e.q-1;s>=0;s--)if(this.datas[t+"."+s]=h?s:i[s],this.datas[t+"."+s+".index"]=s,s>e.q-1+o)for(;e.childNodes.length;){let t=e.childNodes[e.childNodes.length-1];if(t.o!==s)break;e.Y[s].prepend(t)}e.q+=o}}this.g.effect(e.value,t,h,this.l[e.value])}else"ref"===e.name?this.O(e.value,t):h=!1;h&&(t.removeAttribute(e.name),i--)}}X(t,i){for(;t.childNodes.length;){let s=t.childNodes[0];i.appendChild(s)}}}customElements.define("x-element-prototype-factory",s),window.define=function(t,i){let e=`x${t}Element`;if(window[e])throw`Element x-${t} is already defined !`;if(!i)throw`Element x-${t} need a render function !`;return window[e]=class extends s{constructor(){super()}static name=t;static $=i;static A=!1;static style=!1},window[e].prototype.v=window[e],customElements.define(`x-${t}`,window[e]),window[e]}}();
