!function(){"use strict";let t,e=0;let i=/\{[a-zA-Z0-9_.$!?|-]+\}/g;class s extends HTMLElement{constructor(){super(),this.t={},this.i=this.i||{},this.h={},this.custom={},this.init()}init(){this.l(),this.o(),this.u()}ref(t){if(this.t[t])return this.t[t][0]}refs(t){return this.t[t]}m(t,e){let i=t.split("|"),s=i[0].split(".");return"!"===s[0][0]&&(s.g="!",s[0]=s[0].substring(1)),e&&e[s[0]]&&s.splice(0,1,...e[s[0]][0],e[s[0]][1]),s.h=i,s}p(t,e){let s={},h=t.match(i);if(h)for(let t of h)s[t]||(s[t]=this.m(t.substring(1,t.length-1),e));else s.default=this.m(t,e);return s}getData(t){let e=this.i;for(let i of t)if(e=e[i],void 0===e)break;let i=t.g?!e:e;for(let e=1;e<t.h.length;e++){let s=this.h[t.h[e]];i=s?s(i):i}return i}$(t,e){return t.default?this.getData(t.default):e.replace(i,(e=>this.getData(t[e])))}o(){let t=this.i;t.body=this.childNodes;for(let e of this.attributes)if(!this.P(e))if("datas-"===e.name.substring(0,6)){let i=e.name.substring(6),s=JSON.parse(e.value);t[i]=s}else t[e.name]=e.value}l(){this.X={v:{},effect(t,e,i){let s=this.v;s[t]||(s[t]=new Map),s[t].get(e)||s[t].set(e,[]),s[t].get(e).push(i)},A(t,e){if(this.v[t])for(let[i,s]of this.v[t])for(let t of s)t(e,i)},set(t,e,i){return t[e]=i,this.A(e,i),!0}},this.datas=new Proxy(this.i,this.X)}D(t,e){let i=this.t;i[t]||(i[t]=[]),i[t].push(e)}O(t){return(t.g||"")+t.join(".")}effect(t,e){this.X.effect(t,this,e),e(this.i[t],this)}filter(t,e){this.h[t]=e}iterable(t,e){this.i[e]=new Proxy(this.datas,function(t){return{get:(e,i)=>"_xiterable"===i||("get"===i?e[t]:{get key(){return i},get value(){return e[t][i]},get parent(){return e[t]}})}}(t)),this.effect(t,(()=>{this.X.A(e,this.i[t])}))}u(){this.M.F.call(this,this.datas,this.k.bind(this),this.R.bind(this))}k(t){if(t){let e=this.M;"string"==typeof t?(e.I||(e.I=s.parse(t)),this.S=e.I.cloneNode(!0).childNodes):this.S=e.I=t;for(let t of this.S)1===t.nodeType&&(e.selector&&t.setAttribute("style-ref",e.selector),this._(t));this.replaceWith(...this.S)}}R(i){let s=this.M;if(!s.selector){if(s.I)throw`You must use style() before render() in x-${s.j} !`;s.selector=function(i){let s="x"+e++;t||(t=document.createElement("style"),t.id="x-stylesheet",document.head.appendChild(t));let h=`[style-ref="${s}"]`;return t.textContent+=i(h),s}(i)}}_(t,e){t.C||(this.H(t,e),this.J(t)||this.L(t,e))}L(t,e){if(!this.J(t))for(let i of[].slice.call(t.children))this._(i,e)}H(t,e){t.component=this,t.C=!0,this.N(t)?this.T(t,e):this.J(t)?this.V(t,e):this.Y(t,e)}T(t,e={}){let i,h=t.tagName.substring(2),r=this.m(t.getAttribute("var"),e.replace),n=t.getAttribute("key"),l=document.createComment(`x-${h}-begin`),f=document.createComment(`x-${h}-end`),o=t.innerHTML,u=document.createElement("div");if(u.append(...t.childNodes),t.replaceWith(l,f),"IF"===h)this.L(u,e),i=()=>{let t,e=this.getData(r),i=l.nextSibling===f;if(e&&i)for(;u.childNodes.length;)f.parentNode.insertBefore(u.childNodes[0],f);else if(!e&&!i)for(;(t=l.nextSibling)!==f;)u.append(t)};else{if("FOR"!==h)return;{let t=[],u=0;i=()=>{let i=this.getData(r);if(void 0===i)return;i.Z&&(i=i.get);let d="number"==typeof i?i:i.length,w=d-u;if(w>0)for(let i=u;i<u+w&&i<d;i++){if(!t[i]){n&&(e.replace=e.replace||{},e.replace[n]=[r,i]);let l=s.parse(o);this.L(l,e);let f=document.createComment(`x-${h}-item`);f.q=l,l.prepend(f),t.push(l)}for(;t[i].childNodes.length;)f.parentNode.insertBefore(t[i].childNodes[0],f)}else if(w<0)for(let e=u-1;e>u-1+w&&e>=0;e--){let i=f.previousSibling;for(;(!i.q||i.q!==t[e])&&i!==l;)i=f.previousSibling,t[e].prepend(i)}u+=w}}}this.X.effect(r[0],t,i),i()}V(t,e={}){for(let i of t.attributes)if(this.P(i)){let s=i.name.substring(2),h=i.value,r=this.p(h,e.replace),n=()=>{t.datas[s]=this.$(r,h)};t.i||(t.datas=t.i={}),t.i[s]=this.$(r,h);for(let e in r)this.X.effect(r[e][0],t,n)}else"ref"===i.name&&this.D(i.value,t)}Y(t,e={}){for(let i=0;i<t.attributes.length;i++){let s=t.attributes[i],h=!0;if(this.P(s)){let i=s.name.substring(2),h=s.value,r=this.p(h,e.replace),n=()=>{t.setAttribute(i,this.$(r,h))};"text"===i?n=()=>{t.textContent=this.$(r,h)}:"html"===i?n=()=>{t.innerHTML=this.$(r,h)}:"append"===i||"prepend"===i?n=()=>{let e=this.getData(r.default);e&&(e.length?t[i](...e):t[i](e))}:"show"===i&&(n=()=>{this.getData(r.default)?t.style.removeProperty("display"):t.style.display="none"});for(let e in r)this.X.effect(r[e][0],t,n);n()}else"ref"===s.name?this.D(s.value,t):h=!1;h&&(t.removeAttribute(s.name),i--)}}N(t){return"X-FOR"===t.tagName||"X-IF"===t.tagName}J(t){return"X"===t.tagName[0]&&"-"===t.tagName[1]}P(t){return"x"===t.name[0]&&"-"===t.name[1]}}s.B=new DOMParser,s.parse=t=>s.B.parseFromString(t,"text/html").body,window.define=function(t,e){let i=`x${t}Element`;if(window[i])throw`Element x-${t} is already defined !`;if(!e)throw`Element x-${t} need a render function !`;return window[i]=class extends s{constructor(){super()}},window[i].j=t,window[i].F=e,window[i].I=!1,window[i].selector=!1,window[i].prototype.M=window[i],customElements.define(`x-${t}`,window[i]),window[i]}}();
