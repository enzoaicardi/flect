!function(){"use strict";let t,i=0;function e(e){let s="x"+i++;t||(t=document.createElement("style"),t.id="x-scoped-stylesheet",document.head.appendChild(t));let h=`[style-ref="${s}"]`;return t.textContent+=e(h),s}class s extends HTMLElement{static t=new DOMParser;static parse(t){return s.t.parseFromString(t,"text/html").body}constructor(){super(),this.i={},this.h=this.h||{},this.l=this.l||!1,this.custom={},this.hasAttribute("x-noinit")||this.init()}init(){this.o(),this.u(),this.m()}ref(t){return this.i[t]?this.i[t][0]:void 0}refs(t){return this.i[t]}p(t){let i=t.split(".");return"!"===i[0][0]&&(i.g=!0,i[0]=i[0].substring(1)),i}v(t){let i=this.h;for(let e of t)if(i=i[e],void 0===i)break;return t.g?!i:i}u(){this.h.body=[].slice.call(this.childNodes),this.h.html=this.innerHTML,this.h.text=this.textContent;for(let t of this.attributes)if(!this.P(t))if("datas-"===t.name.substring(0,6)){let i=t.name.substring(6),e=JSON.parse(t.value);this.h[i]=e}else this.h[t.name]=t.value}o(){this.$={D:{},effect(t,i,e,s){this.D[t]||(this.D[t]=new Map),this.D[t].get(i)||this.D[t].set(i,[]),this.D[t].get(i).push(e),void 0!==s&&e(s,i)},clear(t,i){i?this.D[t].delete(i):delete this.D[t]},M(t,i){if(this.D[t])for(let[e,s]of this.D[t])for(let t of s)t(i,e)},set(t,i,e){return t[i]=e,this.M(i,e),!0}},this.datas=new Proxy(this.h,this.$)}k(t){return(t.g?"!":"")+t.join(".")}O(t,i){this.i[t]||(this.i[t]=[]),this.i[t].push(i)}iterable(t,i){this.h[i]=new Proxy(this.datas,function(t){return{get:(i,e)=>"_xiterable"===e||("get"===e?i[t]:{get key(){return e},get value(){return i[t][e]},get parent(){return i[t]}})}}(t)),this.effect(t,(()=>{this.$.M(i,this.h[t])}))}m(){this.X.S.call(this,this.datas,this.A.bind(this),this.C.bind(this))}A(t){if(t){"string"==typeof t?(this.X.j||(this.X.j=s.parse(t)),this.H=this.X.j.cloneNode(!0).childNodes):this.H=this.X.j=t;for(let t of this.H)1===t.nodeType&&(this.X.selector&&t.setAttribute("style-ref",this.X.selector),this.J(t)),t.l=this.l;this.replaceWith(...this.H)}}C(t){if(!this.X.selector){if(this.X.j)throw`You must use style() before render() in x-${this.X.name} !`;this.X.selector=e(t)}}effect(t,i){this.$.effect(t,this,i,this.h[t])}L(t,i,e){this.N(t,i,e),this.R(t)||this.T(t,i,e)}T(t,i,e){let s=t.children;for(let t of s)this.L(t,i,e)}N(t,i,e){for(let s of t.attributes)if(this.P(s)){let h=this.p(s.value);h[0]===i&&(h[0]=e,t.setAttribute(s.name,this.k(h)))}}J(t){this.Y(t),this.R(t)||this._(t)}_(t){let i=t.children;for(let t of i)this.J(t)}Y(t){t.q||(t.component=this,t.q=!0,this.R(t)?this.B(t):this.F(t))}B(t){for(let i of t.attributes)if(this.P(i)){let e=i.name.substring(2),s=this.p(i.value),h=()=>{t.datas[e]=this.v(s)};t.h||(t.datas=t.h={}),t.h[e]=this.v(s),this.$.effect(s[0],t,h)}else"ref"===i.name&&this.O(i.value,t)}F(t){for(let i=0,e=0;i<t.attributes.length;i++,e++){let e=t.attributes[i],h=!0;if(this.P(e)){let i=e.name.substring(2),h=this.p(e.value),r=()=>{t.setAttribute(i,this.v(h))};if("text"===i)r=()=>{t.textContent=this.v(h)};else if("html"===i)r=()=>{t.innerHTML=this.v(h)};else if("append"===i)r=()=>{let i=this.v(h);i&&(i.length?t.append(...i):t.append(i))};else if("prepend"===i)r=()=>{let i=this.v(h);i&&(i.length?t.prepend(...i):t.prepend(i))};else if("toggle"===i)r=()=>{let i=this.v(h);t.classList.toggle(i,i)};else if("show"===i)r=()=>{this.v(h)?t.style.removeProperty("display"):t.style.display="none"};else if("if"===i)t.G||(t.G=document.createElement("div"),this._(t)),r=()=>{let e=this.v(h),s=t.childNodes.length;"if"===i&&(e&&!s?this.I(t.G,t):!e&&s&&this.I(t,t.G))};else if("for"===i){const i=e.value,n=t.getAttribute("var");t.K||(t.K=[],t.U=0,t.V=s.parse(t.innerHTML),t.innerHTML=""),r=()=>{let e=this.v(h);if(void 0===e)return;e.W&&(e=e.get);let s="number"==typeof e?e:e.length,r=s-t.U;if(r>0)for(let e=t.U;e<t.U+r&&e<s;e++){if(!t.K[e]){let s=t.V.cloneNode(!0);n&&this.T(s,n,i+"."+e),s.childNodes.forEach((t=>{t.l=e})),this._(s),t.K.push(s)}this.I(t.K[e],t)}else if(r<0)for(let i=t.U-1;i>t.U-1+r&&i>=0;i--)for(;t.childNodes.length;){let e=t.childNodes[t.childNodes.length-1];if(e.l!==i)break;t.K[i].prepend(e)}t.U+=r}}this.$.effect(h[0],t,r,this.h[h[0]])}else"ref"===e.name?this.O(e.value,t):h=!1;h&&(t.removeAttribute(e.name),i--)}}I(t,i){for(;t.childNodes.length;){let e=t.childNodes[0];i.appendChild(e)}}R(t){return"X"===t.tagName[0]&&"-"===t.tagName[1]}P(t){return"x"===t.name[0]&&"-"===t.name[1]}}customElements.define("x-element-prototype-factory",s),window.define=function(t,i){let e=`x${t}Element`;if(window[e])throw`Element x-${t} is already defined !`;if(!i)throw`Element x-${t} need a render function !`;return window[e]=class extends s{constructor(){super()}static name=t;static S=i;static j=!1;static selector=!1},window[e].prototype.X=window[e],customElements.define(`x-${t}`,window[e]),window[e]}}();
