!function(){"use strict";class t extends HTMLElement{static domParser=new DOMParser;constructor(){super(),this._xelement=!0,this._xrefs={},this._xdatas=this._xdatas||{},this._xindex=this._xindex||!1,this.hasAttribute("noinit")||this.init()}init(){this.setStaticDatas(),this.setProxy(),this.setDOM()}ref(t){return this._xrefs[t]?this._xrefs[t][0]:void 0}refs(t){return this._xrefs[t]}getDatasFromObject(t,e,s){if("string"==typeof e)return!1;for(let a in e){var i=!0;let l=t+"."+a;this.getDatasFromObject(l,e[a],s)||s(l,e[a])}return i||!1}setStaticDatas(){this._xdatas.body=this.innerHTML,this._xdatas.childs=[].slice.call(this.childNodes),this._xdatas.content=this.textContent;for(let t of this.attributes)if("x"!==t.name[0]||"-"!==t.name[1])if("datas-"===t.name.substring(0,6)){let e=t.name.substring(6),s=JSON.parse(t.value);this.flat(e,s)}else this._xdatas[t.name]=t.value}setProxy(){this.proxy={effects:{},effect(t,e,s){this.effects[t]||(this.effects[t]=new Map),this.effects[t].get(e)||this.effects[t].set(e,[]),this.effects[t].get(e).push(s)},clear(t,e){e?this.effects[t].delete(e):delete this.effects[t]},set(t,e,s){if(t[e]=s,this.effects[e])for(let[t,i]of this.effects[e])for(let e of i)e(s,t);return!0}},this.datas=new Proxy(this._xdatas,this.proxy)}setDOM(){this.class.render.call(this,this.datas,this.buildDOM.bind(this))}addRef(t,e){this._xrefs[t]||(this._xrefs[t]=[]),this._xrefs[t].push(e)}flat(t,e){this._xdatas[t]=e,this.getDatasFromObject(t,e,((t,e)=>{this._xdatas[t]=e}))}buildDOM(e){if(!e)return;this.class.template||(this.class.template=t.domParser.parseFromString(e,"text/html")),this._xtemplate=this.class.template.cloneNode(!0).body,this.bindElements(this._xtemplate);const s=this._xtemplate.childNodes;for(let t of s)t._xindex=this._xindex,t.composite=this,this.class.style&&1===t.nodeType&&(console.log(t),t.setAttribute("style-ref",this.class.style));this.replaceWith(...s)}effect(t,e){this.proxy.effect(t,this,e)}bindElement(t){"X"===t.tagName[0]&&"-"===t.tagName[1]?this.bindDatas(t):this.bindAttributes(t)}bindElements(t){let e=t.querySelectorAll("*");for(let t of e)this.bindElement(t)}bindData(t,e,s){t._xdatas[s]=this._xdatas[e],this.proxy.effect(e,t,((t,e)=>{e.datas[s]=t}))}bindDatas(t){for(let e of t.attributes)if("x"===e.name[0]&&"-"===e.name[1]){let s=e.name.substring(2);t._xdatas||(t._xdatas={}),"datas-"===s.substring(0,6)&&(s=s.substring(6),this.getDatasFromObject("",this._xdatas[e.value],(i=>{this.bindData(t,e.value+i,s+i)}))),this.bindData(t,e.value,s)}}bindAttributes(t){for(let e=0,s=0;e<t.attributes.length;e++,s++){let s=t.attributes[e],i=!0;if("x"===s.name[0]&&"-"===s.name[1]){let e=s.name.substring(2),i=(t,s)=>{s.setAttribute(e,t)};"text"===e?i=(t,e)=>{e.textContent=t}:"html"===e?i=(t,e)=>{e.innerHTML=t}:"toggle"===e?i=(t,e)=>{e.classList.toggle(t,t)}:"show"===e?i=(t,e)=>{t?e.style.removeProperty("display"):e.style.display="none"}:"if"===e?i=(t,e)=>{e._xjar||(e._xjar=document.createElement("div"));let s=e.childNodes.length;t&&!s&&this.cession(e._xjar,e),!t&&s&&this.cession(e,e._xjar)}:"for"===e&&(i=(t,e)=>{e._xjarList||(e._xjarList=[],e._xcount=0,e._xmodel=document.createElement("div"),this.cession(e,e._xmodel));let s=t.length-e._xcount;if(s>0)for(let t=e._xcount;t<e._xcount+s;t++){if(!e._xjarList[t]){let s=e._xmodel.cloneNode(!0);s.childNodes.forEach((e=>e._xindex=t)),this.bindElements(s),e._xjarList.push(s)}this.cession(e._xjarList[t],e)}else if(s<0)for(let t=e._xcount-1;t>e._xcount-1+s;t--)for(;e.childNodes.length;){let s=e.childNodes[e.childNodes.length-1];if(s._xindex!==t)break;e._xjarList[t].appendChild(s)}e._xcount+=s}),i(this._xdatas[s.value],t),this.proxy.effect(s.value,t,i)}else"ref"===s.name?this.addRef(s.value,t):"var"===s.name?t._xvar=s.value:i=!1;i&&(t.removeAttribute(s.name),e--)}}cession(t,e){for(;t.childNodes.length;){let s=t.childNodes[0];e.appendChild(s)}}}customElements.define("x-element-prototype-factory",t);let e,s=0}();
